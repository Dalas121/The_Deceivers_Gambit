#textdomain wesnoth-tdg
    
[scenario]
    id,map_file,name=10x_Revelry,10x_Revelry.map,_"Revelry"
    next_scenario,victory_when_enemies_defeated=11_The_Traitor,no
    theme=Cutscene_Minimal
    
    {DEFAULT_SCHEDULE_DUSK}
    {SCENARIO_MUSIC breaking_the_chains.ogg}
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    [side]
        side,controller,color=1,human,red
        id,defeat_condition,gold=Delfador,never,0
        team_name=wesnoth
    [/side]
    
    [side]
        side,controller,color=2,ai,wesred
        type,id,name,facing="Lieutenant",Moreth,_"Moreth",sw
        {MODIFICATIONS( {TRAIT_QUICK} {TRAIT_STRONG} )}
        hidden,gold,income=yes,yes,0,-2
        team_name=wesnoth
    [/side]
    {STARTING_VILLAGES_AREA 2 15 10 9}
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                    PREPARE MAP
    #######################################################################################################################################################
    [event]
        name=prestart
        
        #############################
        # SCENERY
        #############################
        {PLACE_IMAGE terrain/castle/encampment/tent2.png  6 12} # these are "keeps"
        {PLACE_IMAGE terrain/castle/encampment/tent2.png 11 14}
        {PLACE_IMAGE items/gold-coins-large.png 14 10} # matching S12
        
        
        #############################
        # GUARDS
        #############################
        {GENERIC_UNIT 2 "Pikeman"  10  7} {FACING ne}
        {GENERIC_UNIT 2 "Spearman"  8  8} {FACING nw}
        {GENERIC_UNIT 2 "Pikeman"   8 11} {FACING nw}
        {GENERIC_UNIT 2 "Bowman"   10 11} {FACING ne}
        {GENERIC_UNIT 2 "Spearman" 11 12} {FACING se}
        
        {GENERIC_UNIT 2 "Swordsman" 23 12} {FACING se}
        
        {GENERIC_UNIT 2 "Horseman" 15 4} {FACING nw}
        {GENERIC_UNIT 2 "Horseman" 17 5} {FACING ne}
        {GENERIC_UNIT 2 "Knight"   19 5} {FACING ne}
        
        {GENERIC_UNIT 2 "Bowman"   24 11} {FACING se}
        {GENERIC_UNIT 2 "Spearman" 27 13} {FACING se}
        
        {GENERIC_UNIT 2 "Spearman"   31 6} {FACING ne}
        {GENERIC_UNIT 2 "Javelineer" 32 6} {FACING ne}
        {GENERIC_UNIT 2 "Spearman"   29 6} {FACING ne}
        
        
        
        #############################
        # REVELERS
        #############################
        {GENERIC_UNIT 2 "Footpad" 13 6} {GENDER female} {FACING se}
        {RECALL_INFANTRYMAN 0 14 7 Fencer {FACING ne}} # this position is used to change side later
        {MODIFY_UNIT x,y=14,7 side 2}
        {GENERIC_UNIT 2 "Thief"   14 7} {GENDER male}   {FACING ne}
        {RECALL_COMPANION 15 7}
        {MODIFY_UNIT id=$companion_id facing nw}
        {MODIFY_UNIT id=$companion_id side 2}
        
        {GENERIC_UNIT 2 "Mage" 14 12} {GENDER female} {FACING ne}
        {GENERIC_UNIT 2 "Mage" 15 12} {GENDER male}   {FACING sw}
        
        
        #############################
        # UNITS
        #############################
        {RECALL_XY Delfador 22 8}
        {MODIFY_UNIT id=Delfador facing sw}
        {GIVE_OBJECT_TO id=Delfador id,duration=at_ease,scenario}
        [modify_unit]
            {FILTER id=Delfador}
            facing=sw
            [filter_recall]
            [/filter_recall]
        [/modify_unit]
        
        {RECALL_XY Deoran 18 17}
        [modify_unit]
            {FILTER id=Deoran}
            facing=sw
            side=2
            [filter_recall]
            [/filter_recall]
        [/modify_unit]
        
        [unit]
            {SINGLEUNITWML_GARARD}
            side,x,y,facing=2,19,10,ne
            {MODIFICATIONS( [object]
                {EFFECT new_attack (
                    name,icon=_"punch",attacks/fist-human.png
                    range,type,damage,number=melee,impact,4,3
                )}
                {EFFECT new_animation ([attack_anim]
                    {FILTER_ATTACK name=punch}
                    start_time=-200
                    {FRAME image="units/garard/garard.png:200"}
                    {SOUND:HIT_AND_MISS fist.ogg fist.ogg -50}
                    {FRAME image="units/garard/garard.png:200"}
                [/attack_anim])}
            [/object] )}
        [/unit]
        {RESTORE_GARARD}
    [/event]
    
    
    
    
    #######################################################################################################################################################
    #                                                                   CUTSCENE PART 1
    #######################################################################################################################################################
    [event]
        name=start
        
        #############################
        # THREE CHEERS
        #############################
        {DELAY 500}
        [message]
            speaker=Deoran
            message=_"Three cheers for Delfador, hero of the Abez!"
        [/message]
        [message]
            speaker=Garard
            message=_"Three cheers— three cheers for Delfador the Great! Hurrah!" # cheers for the King of Wesnoth
        [/message]
        
        {MODIFY_UNIT x,y=15,7 facing se} [message]
            x,y=15,7
            message=_"Hurrah for Delfador!"
        [/message]
        {MODIFY_UNIT x,y=15,7 facing nw}
        
        {MODIFY_UNIT x,y=10,8 facing se}
        [message]
            x,y=10,8
            message=_"Hooray for Delfador!"
        [/message]
        {MODIFY_UNIT x,y=10,8 facing nw}
        
        {MODIFY_UNIT x,y=15,12 facing ne}
        [message]
            x,y=15,12
            message=_"Hurrah for Del— *hic* Delfador!"
        [/message]
        {MODIFY_UNIT x,y=15,12 facing sw}
        
        [message]
            speaker=Delfador
            message=_"Ha ha ha, thank you all! That’s right, I’m Wesnoth’s hero! Your hero Delfador the Great, here in the flesh!"
        [/message]
        
        #############################
        # ALL IS WELL
        #############################
        [message]
            speaker=Garard
            message=_"Oh ho, someone fetch me more wine! The night’s still young; I’m ready for a proper CELEBRATION!!"
        [/message]
        [message]
            speaker=Garard
            message=_"A pity the boy couldn’t be here. Some days I worry... Bah, Delfador is the hero tonight!"
        [/message]
        [message]
            speaker=Delfador
            message=_"I started as an inglorious apprentice, without even a name to call my own. And now I’m one of the most celebrated mages in all Wesnoth! This is everything I ever dreamed of!!"
        [/message]
        [message]
            speaker=Delfador
            message=_"I’m giddy with joy... or maybe it’s also the wine too, heh."
        [/message]
        [message]
            speaker=Deoran
            message=_"My friend, you deserve it. Without most of their saurian allies Clan Blackcrest is on the run, and Clan Whitefang is falling back out of the eastern hills."
        [/message]
        [message]
            speaker=Deoran
            message=_"At long last lift the shadows of war; the realm is finally at peace. Perchance the coming days will bring laughter to the streets of Weldyn once again."
        [/message]
        [message]
            speaker=Delfador
            message=_"For the first time in a long time, all is finally well with the world."
        [/message]
        
        # this is a bit of a fake-out ending
        # there's still a lot of mysteries unresolved, but as far as the characters are concerned they think they've won
        {SCREEN_FADER 0,0,0 255 3000}
        {FIRE_EVENT cutscene_part_2}
    [/event]
        
    #######################################################################################################################################################
    #                                                                   CUTSCENE PART 2
    #######################################################################################################################################################
    [event]
        name=cutscene_part_2
        
        #############################
        # REPOPULATE MAP
        #############################
        [replace_schedule]
            {DEFAULT_SCHEDULE_FIRST_WATCH} # same time used in S12
        [/replace_schedule]
        {PUT_TO_RECALL_LIST side=1}
        {PUT_TO_RECALL_LIST(
            side=2
            {NOT x,y=15,4}
            {NOT x,y=11,12}
            {NOT x,y=10,8}
        )}
        {FADE_MUSIC_OUT 3000}
        
        
        #############################
        # DELFADOR USES THE LATRINES
        #############################
        {SCREEN_FADER 0,0,0 0 1000}
        {DELAY 500}
        {RECALL_XY Delfador 16 8}
        {MODIFY_UNIT id=Delfador facing sw}
        [capture_village]
            side,x,y=2,16,8
        [/capture_village]
        [message]
            speaker=Delfador
            message=_"*Yawn*"
        [/message]
        [message]
            speaker=Delfador
            message=_"Urgh, what a headache. I shouldn’t have drank so much... now nature calls."
        [/message]
        {DELAY 250}
        {MOVE_UNIT id=Delfador 26 5}
        [hide_unit]
            id=Delfador
        [/hide_unit]
        {MODIFY_UNIT id=Delfador facing sw}
        {DELAY 1500}
        [unhide_unit]
            id=Delfador
        [/unhide_unit]
        {DELAY 500}
        [message]
            speaker=Delfador
            #po: Delfador's woken up in the middle of the night to go use the latrines
            message=_"Disgusting. Alduin really needs to invent a spell for cleaning latrines."
        [/message]
        [message]
            speaker=Delfador
            #po: Delfador's woken up in the middle of the night to go use the latrines
            message=_"...maybe as High Advisor I can finally get someone to research that. *yawn*"
        [/message]
        {REPLACE_SCENARIO_MUSIC underground.ogg}
        {FADE_MUSIC_IN 100}
        {MOVE_UNIT id=Delfador 26 6}
        {MOVE_UNIT id=Delfador 25 7}
        {DELAY 500}
        [unit]
            {SINGLEUNITWML_ASHEVIERE}
            side,x,y,facing=2,28,7,sw
            animate=yes
        [/unit]
        {MODIFY_UNIT id=Delfador facing se}
        {DELAY 500}
        
        
        #############################
        # DELFADOR MEETS ASHEVIERE
        #############################
        [message]
            speaker=Delfador
            message=_"Oh!"
        [/message]
        [message]
            speaker=Delfador
            message=_"Hello there, your majesty. Shouldn’t you be asleep with Garard? It’s not every day that I— err, your husband wins a war — now we can finally relax!"
        [/message]
        [message]
            speaker=Delfador
            message=_"—you... don’t look so good. Your skin is bruised in some places but ashen in others, and there are deep bags under your eyes. Stressed about the war, perhaps?"
        [/message]
        {DELAY 500}
        [message]
            speaker=Asheviere
            message=_"Hello Delfador.
I was not expecting to see you again."
        [/message]
        [message]
            speaker=Delfador
            message=_"Oh, I think I understand. Never fear, it takes more than a few orcs and saurians to bring down the hero of Wesnoth!"
        [/message]
        [message]
            speaker=Delfador
            message=_"...all in a day’s work for *yawn* Delfador the Great, High Advisor to the Crown! Next time someone needs killing, you’ll know who to call."
        [/message]
        {DELAY 500}
        [message]
            speaker=Asheviere
            message=_"Yes.
I will."
        [/message]
        [message]
            speaker=Delfador
            message=_"Umm..."
        [/message]
        [message]
            speaker=Delfador
            message=_"...yeah. Well, I should be getting back to bed—"
        [/message]
        
        {RECALL_XY Garard 16 8}
        {MODIFY_UNIT id=Garard facing se}
        {MODIFY_UNIT id=Delfador facing sw}
        {DELAY 250}
        {MOVE_UNIT id=Garard 25 9}
        {MODIFY_UNIT id=Delfador facing se}
        {MOVE_UNIT id=Garard 27 9}
        {DELAY 250}
        [message]
            speaker=Garard
            message=_"What’s going on here."
        [/message]
        [message]
            speaker=Asheviere
            message=_"I—"
        [/message]
        [message]
            speaker=Garard
            message=_"Careful, Delfador — don’t believe a word she says. Woman, are you not satisfied with my son; you must have my wizard too?"
        [/message]
        [message]
            speaker=Delfador
            message=_"...hang on, hang on! We’ve just had a great victory; let’s all stay positive."
        [/message]
        [message]
            speaker=Garard
            message=_"The word “positive” means nothing to the likes of her. Away with you, wench, and save your barbed tongue for another day."
        [/message]
        {MOVE_UNIT id=Asheviere 32 9}
        {KILL id=Asheviere}
        
        
        #############################
        # GARARD IS SAD
        #############################
        {MODIFY_UNIT id=Garard facing sw}
        {DELAY 500}
        {SOUND skill-panacea-quiet.wav}
        [message]
            speaker=Garard
            message=_"Where’s that wine from earlier... anything to take my mind off this lousy woman... lousy woman, Delfador.

I hate her. She brings out the worst in me, she really does."
        [/message]
        [message]
            speaker=Garard
            message=_"And Eldred suffers for it. He hardly speaks a word to me anymore, you know? Head down, eyes shifting, always whispering back and forth — with <i><b>her</b></i>."
        [/message]
        [message]
            speaker=Garard
            message=_"What can I do? I’ve tried talking to Eldred, tried sending Asheviere away, even tried locking her up..."
        [/message]
        [message]
            speaker=Delfador
            message=_"Locking her—!?"
        [/message]
        [message]
            speaker=Garard
            message=_"But it’s no use. She always weasels her way out, weasels her way back into my life. Back into Eldred’s."
        [/message]
        {DELAY 250}{MOVE_UNIT id=Garard 26 8}{DELAY 250}
        [message]
            speaker=Garard
            message=_"Wizard, you’re my royal advisor. But more than that, I count you as a friend. A friend, Delfador. I must know your mind — and please, answer me truthfully."
        [/message]
        [message]
            speaker=Garard
            message=_"Delfador... am I a good man?"
        [/message]
        [message]
            speaker=Delfador
            message=_"Err—"
        [/message]
        [message]
            speaker=Delfador
            message=_"—you are a great king, my lord! Look at all you and I have achieved together! The ford is seized, Fort Garard is safe, the northerners are broken!"
        [/message]
        [message]
            speaker=Garard
            message=_"That was not my question."
        [/message]
        {DELAY 250}{MOVE_UNIT id=Garard 27 9}{DELAY 250}
        [message]
            speaker=Garard
            message=_"A great king? My father— father was a great king, Delfador. And <i>his</i> father— and his fathers also great, great all the way back to Haldric I. King Haldric led our people to the entire realm of Wesnoth, the entire race of men!"
        [/message]
        {MODIFY_UNIT id=Garard facing nw}
        [message]
            speaker=Garard
            message=_"Now you’re one of them too! Delfador the Great... but who am I? What have I done? Nearly lost a war? Needed some— some magician’s parlor trick to finish things? I can’t protect my people. I can’t even protect my son..."
        [/message]
        {DELAY 250}{MOVE_UNIT id=Garard 26 10}{DELAY 250}
        [message]
            speaker=Garard
            message=_"I don’t know Delfador, I don’t know; just, I don’t know. Maybe it’s the wine talking, maybe it’ll all be better tomorrow..."
        [/message]
        {DELAY 1500}
        
        #############################
        # ELDRED ARRIVES
        #############################
        [unit]
            {SINGLEUNITWML_ELDRED}
            side,x,y,facing=2,38,9,nw
            hitpoints=17
            animate=yes
        [/unit]
        {MOVE_UNIT id=Eldred 37 9}
        {MOVE_UNIT id=Eldred 36 9}
        {MOVE_UNIT id=Eldred 35 9}
        {MODIFY_UNIT id=Garard facing ne}
        [harm_unit]
            {FILTER id=Eldred}
            amount,animate=4,yes
        [/harm_unit]
        {PLACE_IMAGE scenery/blood-1.png 35 9}
        {DELAY 500}
        {MOVE_UNIT id=Eldred 33 10}
        [message]
            speaker=Eldred
            message=_"<span size='x-small'>Father.</span>"
        [/message]
        {MOVE_UNIT id=Eldred 32 9} # the same village that Asheviere entered
        [message]
            speaker=Garard
            message=_"What are you doing here, boy? You should be with your uncle guarding the fort."
        [/message]
        [message]
            speaker=Garard
            message=_"And what’s the matter with— you’re <b><i>injured</i></b>!?"
        [/message]
        {MOVE_UNIT id=Garard 29 10}
        [message]
            speaker=Garard
            message=_"Are you all right? What happened! Where’s that useless Methor when you need him...

Son, <b><i>how did this happen</i></b>."
        [/message]
        
        
        #############################
        # NEWS OF THE BETRAYAL
        #############################
        [message]
            speaker=Eldred
            message=_"<span size='x-small'>It’s about your—</span>"
        [/message]
        [message]
            speaker=Eldred
            message=_"..."
        [/message]
        [message]
            speaker=Eldred
            message=_"...father, it’s uncle. Prince Arand."
        [/message]
        [message]
            speaker=Eldred
            #po: Eldred doesn’t show a lot of emotion here. He's lying, and not very good at it
            message=_"Arand’s declared his claim to the throne. He seized control of Fort Garard. My guards and I tried to stop him, but we couldn’t even come close."
        [/message]
        [message]
            speaker=Eldred
            message=_"He tried to kill me, father. He’s coming for you next."
        [/message]
        {FADE_MUSIC_OUT 3000}
        [message]
            speaker=Eldred
            message=_"Father—?"
        [/message]
        {REPLACE_SCENARIO_MUSIC silence.ogg}
        [message]
            speaker=Garard
            message=_"<b><i>WHAT!?</i></b>"
        [/message]
        {FADE_MUSIC_IN 100}
        {REPLACE_SCENARIO_MUSIC frantic.ogg}
        
        #############################
        # GARARD REACTS
        #############################
        [message]
            speaker=Garard
            message=_"That TREASONOUS son-of-a, son-of— I knew— knew he was acting dodgy lately."
        [/message]
        [message]
            speaker=Garard
            message=_"It all makes sense now. The spies found nothing because they’re HIS spies! And he cautioned me about the scepter —cautioned me so that I would send Lionel away, send away my most loyal general!"
        [/message]
        {DELAY 250}{MOVE_UNIT id=Garard 28 10}{DELAY 250}
        [message]
            speaker=Garard
            message=_"How DARE he threaten me? How DARE he lay a finger on you? I’ll see him hang for this. DEAD, you hear me!? DELFADOR, get over here!"
        [/message]
        # the closest tent; easy for him to overhear while the rest of the army might not
        {RECALL_XY Deoran 24 10}
        {MOVE_UNIT id=Deoran 26 10}
        [message]
            speaker=Deoran
            message=_"My king, I couldn’t help but overhear. I advise caution! This is all so sudden; don’t be hasty. Any decisions made now may be later regrette—"
        [/message]
        [message]
            speaker=Garard
            message=_"SILENCE, exile!

DELFADOR! High advisor, take command of the cavalry; my personal royal cavalry — they’re the only ones I trust. Ride to Fort Garard and burn it to the ground, TO THE GROUND!!"
        [/message]
        [message]
            speaker=Garard
            message=_"I want every one of those traitors dead! And return with Arand’s head— his head, his HEAD! Or don’t return at all, DO YOU HEAR ME!?"
        [/message]
        {DELAY 250}{MOVE_UNIT id=Deoran 25 9}{DELAY 250}
        [message]
            speaker=Deoran
            message=_"Delfador, the king won’t listen to me, but you can change his mind. His mind is clouded by drink and sleep, he’s jumping to extremes."
        [/message]
        [message]
            speaker=Delfador
            message=_"Look, I’m still a little tipsy myself; maybe not in the best condition to be making decisions!"
        [/message]
        [message]
            speaker=Garard
            message=_"There is no decision to be made, wizard. Your king has given you an ORDER. You will obey."
        [/message]
        {DELAY 250}
        {MODIFY_UNIT id=Deoran facing se}
        {MOVE_UNIT id=Delfador 27 8}
        {DELAY 500}
        {MODIFY_UNIT id=Delfador facing sw}
        {DELAY 500}
        {MOVE_UNIT id=Delfador 27 9}
        {MODIFY_UNIT id=Delfador facing se}
        {DELAY 250}
        [message]
            speaker=Delfador
            message=_"...err look, m’lord, maybe—"
        [/message]
        [message]
            speaker=Garard
            message=_"Delfador, from the minute I first met you in the opening days of our war, I knew you were special."
        [/message]
        [message]
            speaker=Garard
            message=_"I LIFTED YOU UP from admidst your peers. I gave you power, prestige, and a position the envy of men twice your age. “Delfador the Great”, would you really throw that all away on the word of a shameful exile?"
        [/message]
        {DELAY 250}{MOVE_UNIT id=Garard 28 9}{DELAY 250}
        [message]
            speaker=Garard
            message=_"I want you to think very, very carefully before you answer."
        [/message]
        {DELAY 1000}
        {MOVE_UNIT id=Delfador 26 9}
        {DELAY 250}
        [message]
            speaker=Delfador
            message=_"..."
        [/message]
        {DELAY 250}
        {MOVE_UNIT id=Delfador 26 10}
        {DELAY 1000}
        {MODIFY_UNIT id=Delfador facing se}
        
        #############################
        # DELFADOR GIVES IN
        #############################
        [message]
            speaker=Delfador
            message=_"All right, all right! Deoran I’m sorry, but... fire and destruction is what I do. I didn’t even have a name before I first began to battle!"
        [/message]
        [message]
            speaker=Delfador
            #po: "I'm nothing" gets echoed by Eldred later, in S13
            message=_"I’ve lived half my life fighting alongside the king, fighting to earn a name for myself. Without that, what am I? I’m nothing."
        [/message]
        [message]
            speaker=Delfador
            message=_"..."
        [/message]
        {MODIFY_UNIT id=Delfador facing sw}
        [message]
            speaker=Delfador
            message=_"Deoran, I don’t want to be remembered as someone like you..."
        [/message]
        # spawn royal cavalry: same as the units we start with in S11
        [unit]
            type=Knight
            id,name=Kaylan,_"Sir Kaylan" # this is Sir Kaylan from HttT's Blackwater Port, but younger
            {MODIFICATIONS(
                {TRAIT_LOYAL}{TRAIT_STRONG}
                {TEAM_COLOR_OVERRIDE () green} 
                [object] {EFFECT profile portrait="portraits/humans/grand-knight-2.webp"} [/object]
            )}
            x,y,facing,animate=21,10,ne,yes
        [/unit]
        {SET_EXPERIENCE_FRACTION x,y=21,10 0.8}
        {GENERIC_UNIT 2 Dragoon    20 10} {FACING se} {ANIMATE} {SET_EXPERIENCE_FRACTION x,y=20,10 0.2}
        {GENERIC_UNIT 2 Horseman   20  8} {FACING se} {ANIMATE} {SET_EXPERIENCE_FRACTION x,y=20,8  0.9}
        {GENERIC_UNIT 2 Horseman   19  8} {FACING se} {ANIMATE} {SET_EXPERIENCE_FRACTION x,y=19,8  0.3}
        {GENERIC_UNIT 2 Cavalryman 18  9} {FACING ne} {ANIMATE} {SET_EXPERIENCE_FRACTION x,y=18,9  0.7}
        [message]
            speaker=Deoran
            message=_"Delfador—"
        [/message]
        {MODIFY_UNIT id=Delfador facing se}
        [message]
            speaker=Delfador
            #po: "I'm loyal" is the same thing Lionel says in S08x
            message=_"I’m loyal, Garard. Royal cavalry, form up on me! We go at once!"
        [/message]
        
        
        #############################
        # CLEANUP
        #############################
        {MODIFY_UNIT id=Deoran side 1}
        [store_unit]
            {FILTER id=Deoran}
            variable,kill=stored_deoran,yes
        [/store_unit]
        
        {MODIFY_UNIT id=$companion_id side 1}
        {MODIFY_UNIT x,y=14,7         side 1}
        [store_unit]
            {FILTER( side=1 {NOT id=Delfador,familiar} )}
            variable,kill=stored_units_s10x,yes
        [/store_unit]
        
        [endlevel]
            result=victory
            {NEW_GOLD_CARRYOVER 100}
            carryover_report,linger_mode,replay_save=no,no,no
        [/endlevel]
    [/event]
[/scenario]




